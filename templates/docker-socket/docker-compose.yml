services:
  docker-socket:
    image: tecnativa/docker-socket-proxy:latest
    container_name: docker-socket
    restart: unless-stopped
    #privileged: 
    security_opt:
      - no-new-privileges:true
    #read_only: true
    #ports:
    #  - "2375:2375"  # Docker Socket Proxy (내부 통신만 사용, 외부 노출 불필요)
    tmpfs:
      - /run
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "2375"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 5s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      # --- 컨테이너 및 리소스 모니터링 ---
      - CONTAINERS=1    # 컨테이너 목록 조회, 상세 정보 및 개별 컨테이너 상태 확인
      - STATS=1         # CPU, 메모리, 네트워크 IO, 디스크 IO 등 실시간 성능 메트릭 수집
      - EVENTS=1        # 컨테이너 생성, 시작, 중지 등 도커 엔진에서 발생하는 실시간 이벤트 수신
      - LOGS=1          # 대시보드 내에서 컨테이너의 stdout/stderr 로그 스트리밍 및 조회
      
      # --- 관리 및 제어 (Write 작업 포함) ---
      - POST=1          # 컨테이너 시작/중지/재시작/삭제 등 생성 및 제어 요청 허용 (필수)
      - EXEC=1          # 실행 중인 컨테이너 내부에서 명령어를 실행(예: 터미널 접속)하기 위한 권한
      
      # --- 이미지 및 인프라 자원 관리 ---
      - IMAGES=1        # 설치된 이미지 목록 조회, 삭제 및 이미지 상세 정보 확인
      - NETWORKS=1      # 도커 네트워크 목록 조회 및 컨테이너별 네트워크 할당 정보 확인
      - VOLUMES=1       # 생성된 볼륨 목록 조회 및 컨테이너와의 연결 상태 확인
      
      # --- 시스템 정보 및 상태 체크 ---
      - PING=1          # 도커 엔진의 생존 여부 확인 (Arcane과 엔진 간 연결 테스트)
      - VERSION=1       # 도커 엔진 버전 및 API 버전 정보 확인
      - INFO=1          # 시스템 전체 요약 정보 (디스크 사용량 등에 참고됨)
      
    networks:
      - docker-socket

networks:
  docker-socket:
    external: true